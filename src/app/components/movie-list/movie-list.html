<!-- <div class="movie-list">
  <header>
    <h1>–ö–∞—Ç–∞–ª–æ–≥ —Ñ–∏–ª—å–º–æ–≤</h1>
    <p>–ù–∞–π–¥–∏—Ç–µ —Å–≤–æ–π —Å–ª–µ–¥—É—é—â–∏–π –ª—é–±–∏–º—ã–π —Ñ–∏–ª—å–º</p>
  </header>

  <div class="search">
    <div class="search-box">
      <input
        type="text"
        placeholder="–ü–æ–∏—Å–∫ —Ñ–∏–ª—å–º–æ–≤..."
        [value]="searchTerm()"
        (input)="onSearch($event)"
        [disabled]="isLoading()"
      />
      @if (searchTerm()) {
        <button (click)="searchTerm.set('')" class="clear-btn">√ó</button>
      }
      @if (isLoading() && !isLoadingMore()) {
        <div class="spinner-small"></div>
      }
    </div>

    @if (movies().length > 0) {
      <div class="stats">
        –ù–∞–π–¥–µ–Ω–æ <strong>{{ totalCount() | number }}</strong> —Ñ–∏–ª—å–º–æ–≤
        @if (searchTerm()) {
          –ø–æ –∑–∞–ø—Ä–æ—Å—É "{{ searchTerm() }}"
        }
      </div>
    }
  </div>

  @if (error()) {
    <div class="error">
      <span>‚ö†Ô∏è {{ error() }}</span>
      <button (click)="clearError()" class="close-btn">√ó</button>
    </div>
  }

  <main>
    @if (isLoading()) {
      <div class="loading">
        <div class="spinner"></div>
        <p>–ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∏–ª—å–º—ã...</p>
      </div>
    }

    @else if (movies().length === 0 && !isLoading() && !error()) {
      <div class="empty">
        <div class="empty-icon">üé¨</div>
        <h3>
          @if (searchTerm()) {
            –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
          } @else {
            –§–∏–ª—å–º–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç
          }
        </h3>
        <p>
          @if (searchTerm()) {
            –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å
          } @else {
            –ù–∞—á–Ω–∏—Ç–µ —Å –ø–æ–∏—Å–∫–∞
          }
        </p>
      </div>
    }

    @else {
      <div class="movies">
        @for (movie of movies(); track movie.id) {
          <div
            class="movie"
            (mouseenter)="onMovieHover($event, movie.id)"
            (mouseleave)="onMovieLeave()"
          >
            <div class="movie-poster">
              @if (movie.primaryImage?.url) {
                <img
                  [src]="movie.primaryImage?.url"
                  [alt]="movie.primaryTitle"
                  (error)="handleImageError($event)"
                />
              } @else {
                <div class="no-poster">üé¨</div>
              }

              @if (movie.rating?.aggregateRating) {
                <div class="rating" [class]="getRatingClass(movie.rating?.aggregateRating)">
                  {{ movie.rating?.aggregateRating | number:'1.1-1' }}
                </div>
              }
            </div>

            <div class="movie-info">
              <h3>{{ movie.primaryTitle }}</h3>

              <div class="movie-details">
                <span>{{ movie.startYear }}</span>
                @if (movie.runtimeSeconds) {
                  <span>{{ formatRuntime(movie.runtimeSeconds) }}</span>
                }
              </div>

              @if (movie.genres?.length) {
                <div class="genres">
                  @for (genre of movie.genres.slice(0, 2); track genre) {
                    <span>{{ genre }}</span>
                  }
                  @if (movie.genres.length > 2) {
                    <span class="more">+{{ movie.genres.length - 2 }}</span>
                  }
                </div>
              }
            </div>

            <button class="more-btn" (click)="navigateToMovie(movie.id)">...</button>
          </div>
        }
      </div>

      @if (showLoadMore()) {
        <div class="load-more">
          <button
            (click)="loadMore()"
            [disabled]="isLoadingMore()"
          >
            @if (isLoadingMore()) {
              <div class="spinner-small"></div>
              –ó–∞–≥—Ä—É–∑–∫–∞...
            } @else {
              –ü–æ–∫–∞–∑–∞—Ç—å –µ—â–µ ({{ totalCount() - movies().length | number }})
            }
          </button>
        </div>
      }
    }
  </main>

  @if (showQuickView() && hoveredMovie()) {
    <div
      class="quick-view"
      (mouseenter)="onQuickViewEnter()"
      (mouseleave)="onQuickViewLeave()"
      [style.left.px]="quickViewPosition().x"
      [style.top.px]="quickViewPosition().y"
    >
      <div class="quick-view-content">
        <div class="quick-view-header">
          @if (hoveredMovie()!.primaryImage?.url) {
            <img [src]="hoveredMovie()!.primaryImage!.url" [alt]="hoveredMovie()!.primaryTitle" />
          }

          <div class="quick-view-info">
            <h3>{{ hoveredMovie()!.primaryTitle }}</h3>

            <div class="quick-view-details">
              <span>{{ hoveredMovie()!.startYear }}</span>
              @if (hoveredMovie()!.runtimeSeconds) {
                <span>{{ formatRuntime(hoveredMovie()!.runtimeSeconds) }}</span>
              }
            </div>

            @if (hoveredMovie()!.rating?.aggregateRating) {
              <div class="quick-view-rating">
                <div class="stars">
                  @let stars = getRatingStars(hoveredMovie()!.rating!.aggregateRating);
                  @for (star of [].constructor(stars.full); track star) {
                    <span class="filled">‚òÖ</span>
                  }
                  @if (stars.half) {
                    <span class="half">‚òÖ</span>
                  }
                  @for (star of [].constructor(stars.empty); track star) {
                    <span>‚òÖ</span>
                  }
                </div>
                <div class="score">
                  {{ hoveredMovie()!.rating!.aggregateRating | number:'1.1-1' }}/10
                  <span>({{ hoveredMovie()!.rating!.voteCount | number }})</span>
                </div>
              </div>
            }
          </div>
        </div>

        <div class="quick-view-body">
          @if (hoveredMovie()!.genres?.length) {
            <div class="section">
              <h4>–ñ–∞–Ω—Ä—ã</h4>
              <div class="genres-list">
                @for (genre of hoveredMovie()!.genres; track genre) {
                  <span>{{ genre }}</span>
                }
              </div>
            </div>
          }

          @if (hoveredMovie()!.plot) {
            <div class="section">
              <h4>–û–ø–∏—Å–∞–Ω–∏–µ</h4>
              <p>{{ hoveredMovie()!.plot }}</p>
            </div>
          }
        </div>

        <div class="quick-view-buttons">
          <button (click)="navigateToMovie(hoveredMovie()!.id)">
            –ü–æ–¥—Ä–æ–±–Ω–µ–µ
          </button>
          <button (click)="showQuickView.set(false)" class="secondary">
            –ó–∞–∫—Ä—ã—Ç—å
          </button>
        </div>
      </div>
    </div>
  }

  <footer>
    <p>–í—Å–µ–≥–æ —Ñ–∏–ª—å–º–æ–≤: {{ totalCount() | number }} | –ó–∞–≥—Ä—É–∂–µ–Ω–æ: {{ movies().length | number }}</p>
  </footer>
</div> -->


<div class="movies-list">
  <h1>–ö–∞—Ç–∞–ª–æ–≥ —Ñ–∏–ª—å–º–æ–≤</h1>
  <input type="text" placeholder="–ü–æ–∏—Å–∫ —Ñ–∏–ª—å–º–æ–≤" (input)="searchTerm.next($any($event.target).value)"
    class="search-input" />

  <div class="movies-container">
    @if (items | async; as movies) {
    <ul class="movies-list">
      @for (movie of movies; track movie.id) {
      <li class="movie-item" (mouseenter)="onMovieHover($event, movie)" (mouseleave)="onMovieLeave()">
        <img [src]="movie.primaryImage?.url" [alt]="movie.primaryTitle">
        <h3>{{ movie.primaryTitle }}</h3>
        <p>{{ movie.startYear }}</p>
      </li>
      } @empty {
      <p class="no-movies">–§–∏–ª—å–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
      }
    </ul>
    } @else {
    <p class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
    }
  </div>

  @if (showQuickView && hoveredMovieId) {
  <div class="quick-view-overlay" (mouseenter)="onQuickViewEnter()" (mouseleave)="onQuickViewLeaved()"
    [style.left.px]="quickViewPosition.x" [style.top.px]="quickViewPosition.y">
    @for (movie of (items | async) || []; track movie.id) {
    @if (movie.id === hoveredMovieId) {
    <div class="quick-view-content">
      <div class="quick-view-header">
        <img [src]="movie.primaryImage?.url" [alt]="movie.primaryTitle" class="quick-view-image">
        <div class="quick-view-title">
          <h3>{{ movie.primaryTitle }}</h3>
          <p class="quick-view-year">
            <strong>–ì–æ–¥:</strong>
            {{ movie.startYear || 'N/A'}}
          </p>
        </div>
      </div>
      <div class="quick-view-details">
        @if (movie.rating?.aggregateRating) {
        <div class="quick-view-rating">
          <span class="rating-star">*</span>
          <span>{{ movie.rating?.aggregateRating }}/10</span>
          <span class="vote-count"> ({{ movie.rating?.voteCount | number }} –≥–æ–ª–æ—Å–æ–≤)</span>
        </div>
        }

        @if (movie.genres) {
        <div class="quick-view-genres">
          <strong>–ñ–∞–Ω—Ä—ã:</strong>
          <div class="genre-tags">
            @for (genre of movie.genres; track genre; let last = $last) {
            <span class="genre-tag">{{ genre }}</span>
            }
          </div>
        </div>
        }

        @if (movie.runtimeSeconds) {
        <div class="quick-view-runtime">
          <strong>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong>
          {{ movie.runtimeSeconds / 60 | number:'1.0-0'}} –º–∏–Ω.
        </div>
        }

        @if (movie.plot) {
        <div class="quick-view-plot">
          <strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong>
          <p> {{ movie.plot }}</p>
        </div>
        }
      </div>
    </div>
    }
    }
  </div>
  }
</div>
